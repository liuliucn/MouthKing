name: NativeAOT Build

on:
  push:
    tags:
      - '*'

jobs:
  sync:
    runs-on: ubuntu-latest
    name: Git Repo Sync
    steps:
    - uses: actions/checkout@v2
      with:
        fetch-depth: 0
    - uses: wangchucheng/git-repo-sync@v0.1.0
      with:
        target-url: "https://gitee.com/tsdyy/mouth-king.git"
        target-username: ${{ secrets.GITLAB_USERNAME }}
        target-token: ${{ secrets.GITLAB_TOKEN }}

  download-artiface:
    runs-on: ubuntu-latest
    steps:

    - name: create gitlab release
      id: create_release
      run: |
        json=(curl -X POST --header 'Content-Type: application/json;charset=UTF-8' 'https://gitee.com/api/v5/repos/tsdyy/mouth-king/releases' \
             -d '{"access_token":"${{ secrets.GITLAB_API_TOKEN }}","tag_name":"${{github.ref_name}}","name":"${{github.ref_name}}","body":"${{github.ref_name}}","target_commitish":"master"}')
        echo "$json"
        echo "::set-output name=json::$json"
    - uses: actions/checkout@v2
    - uses: actions/download-artifact@v4.1.8
    - name: upload artifacts to gitlab
      run: |
        echo "test"
        echo "${{fromJson(steps.create_release.outputs.json).id}}"
        